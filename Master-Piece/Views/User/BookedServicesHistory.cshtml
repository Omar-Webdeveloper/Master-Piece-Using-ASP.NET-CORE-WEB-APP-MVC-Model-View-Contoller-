@model List<BookingHistoryViewModel>

<style>
    .body-content {
        font-family: Arial, sans-serif;
        background-color: #f4f7fb;
        padding: 30px;
        min-height: 100vh;
    }

    h2 {
        color: #2b4c7e;
        margin-bottom: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    th, td {
        padding: 14px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }

    th {
        background-color: #eaf0fb;
        color: #333;
    }

    td {
        color: #555;
    }

        td a {
            color: #2b4c7e;
            text-decoration: none;
        }

            td a:hover {
                text-decoration: underline;
            }

    .no-data {
        color: #777;
        margin-top: 20px;
    }
</style>

<div class="body-content">
    <h2>Your Booking History</h2>

    @if (Model != null && Model.Any())
    {
        <table>
            <thead>
                <tr>
                    <th>Booking ID</th>
                    <th>Booking Title</th>
                    <th>Booking Message</th>
                    <th>Service Name</th>
                    <th>Worker Name</th>
                    <th>Booking Date</th>
                    <th>Status</th>
                    <th>Issue Image</th>
                    <th>Payment</th>
                    <th>Review</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var booking in Model)
                {
                    <tr>
                        <td>@booking.BookingId</td>
                        <td>@booking.BookingTittle</td>
                        <td>@booking.BookingMessae</td>
                        <td>@booking.ServiceName</td>
                        <td>@booking.EmployeeFullName</td>
                        <td>@booking.BookingStartDate?.ToString("yyyy-MM-dd HH:mm")</td>
                        <td>@booking.Status</td>
                        <td>
                            @if (booking.IssueImage != null)
                            {
                                var base64Image = Convert.ToBase64String(booking.IssueImage);
                                var imgSrc = $"data:image/jpeg;base64,{base64Image}";
                                <img src="@imgSrc" alt="Issue Image" style="width: 80px; height: 80px; object-fit: cover;" />
                            }
                            else
                            {
                                <span>No Image</span>
                            }
                        </td>
                        <td>@booking.ServicePrice</td>
                        <td>
                            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#paymentModal" data-booking-id="@booking.BookingId">Pay</button>
                        </td>
                        <td>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#reviewModal" data-booking-id="@booking.BookingId">Review</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="no-data">No booking history found.</p>
    }
</div>

<!-- Payment Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-controller="Payment" asp-action="CreatePayment" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">Make a Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="Payment_BookingID" name="BookingID" />

                    <div class="mb-3">
                        <label>Payment Method:</label><br />
                        <input type="radio" id="cash" name="PaymentMethod" value="Cash" checked onclick="toggleCardFields(false)" />
                        <label for="cash">Cash</label>
                        <input type="radio" id="credit" name="PaymentMethod" value="Credit Card" onclick="toggleCardFields(true)" />
                        <label for="credit">Credit Card</label>
                    </div>

                    <div id="cardFields" style="display:none;">
                        <div class="mb-3">
                            <label>Card Number</label>
                            <input type="text" name="CardNumber" class="form-control" maxlength="16" />
                        </div>
                        <div class="mb-3">
                            <label>CVC</label>
                            <input type="text" name="CVC" class="form-control" maxlength="4" />
                        </div>
                        <div class="mb-3">
                            <label>Expiry Date</label>
                            <input type="date" name="ExpiryDate" class="form-control" />
                        </div>
                    </div>

                    <div class="mb-3">
                        <label>Amount</label>
                        <input type="number" step="0.01" name="Amount" class="form-control" required />
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Submit Payment</button>
                </div>
            </form>
        </div>
    </div>
</div>





<!-- Review Modal -->
<div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-controller="Review" asp-action="CreateReview" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="reviewModalLabel">Leave a Review</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="Review_BookingID" name="BookingID" />

                    <div class="mb-3">
                        <label>Rating:</label><br />
                        @for (int i = 1; i <= 5; i++)
                        {
                            <input type="radio" id="star@i" name="Rating" value="@i" required />
                            <label for="star@i">@i Star</label>
                        }
                    </div>

                    <div class="mb-3">
                        <label>Comment</label>
                        <textarea name="Comment" class="form-control" rows="3" required></textarea>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Submit Review</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    var paymentModal = document.getElementById('paymentModal');
    paymentModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var bookingId = button.getAttribute('data-booking-id');
        document.getElementById('Payment_BookingID').value = bookingId;
    });

    var reviewModal = document.getElementById('reviewModal');
    reviewModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var bookingId = button.getAttribute('data-booking-id');
        document.getElementById('Review_BookingID').value = bookingId;
    });

    function toggleCardFields(show) {
        document.getElementById('cardFields').style.display = show ? 'block' : 'none';
    }
</script>
